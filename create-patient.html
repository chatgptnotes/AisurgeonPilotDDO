<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Patient - AI Surgeon Pilot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .step {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .step h2 {
            margin-top: 0;
            color: #667eea;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background: #5568d3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #17a2b8;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• Create Test Patient</h1>

        <div class="info">
            <strong>üìå Important:</strong> This tool will create the patient PROFILE in your database.
            You'll still need to create the AUTH USER manually in Supabase Dashboard.
        </div>

        <div class="step">
            <h2>Step 1: Create Patient Profile</h2>
            <p>Click the button below to create a test patient profile in your database:</p>
            <button id="createPatientBtn" onclick="createPatientProfile()">
                Create Patient Profile in Database
            </button>
            <div id="step1Result"></div>
        </div>

        <div class="step">
            <h2>Step 2: Create Auth User (Manual)</h2>
            <div id="step2Instructions" style="display:none;">
                <div class="success">
                    <strong>‚úÖ Patient profile created successfully!</strong>
                </div>
                <p>Now you need to create the authentication user:</p>
                <ol>
                    <li>Go to your <a href="https://supabase.com/dashboard/project/qfneoowktsirwpzehgxp" target="_blank">Supabase Dashboard</a></li>
                    <li>Click <strong>Authentication</strong> ‚Üí <strong>Users</strong></li>
                    <li>Click <strong>"Add user"</strong> button</li>
                    <li>Fill in:
                        <ul>
                            <li>Email: <code>patient@test.com</code></li>
                            <li>Password: <code>patient123</code></li>
                            <li>‚úì Auto Confirm User</li>
                        </ul>
                    </li>
                    <li>Click <strong>"Create user"</strong></li>
                </ol>
            </div>
        </div>

        <div class="step">
            <h2>Step 3: Test Login</h2>
            <div id="step3Instructions" style="display:none;">
                <p>After creating the auth user, test the login:</p>
                <ol>
                    <li>Go to: <a href="http://localhost:8080/login" target="_blank">http://localhost:8080/login</a></li>
                    <li>Click <strong>"Patient Login"</strong> tab</li>
                    <li>Enter:
                        <ul>
                            <li>Email: <code>patient@test.com</code></li>
                            <li>Password: <code>patient123</code></li>
                        </ul>
                    </li>
                    <li>Click <strong>"Sign In as Patient"</strong></li>
                </ol>
                <div class="success">
                    <strong>üéâ You should now see the Patient Dashboard!</strong>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        window.supabase = createClient(
            'https://qfneoowktsirwpzehgxp.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFmbmVvb3drdHNpcndwemVoZ3hwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0ODEwODcsImV4cCI6MjA3NzA1NzA4N30.0xQ_uNaM36lBXSJNVuKf5KMqKa0sYgFKjpL2a8VKo-o'
        );

        window.createPatientProfile = async function() {
            const btn = document.getElementById('createPatientBtn');
            const resultDiv = document.getElementById('step1Result');

            btn.disabled = true;
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Creating patient profile...</p></div>';

            try {
                const { data, error } = await window.supabase
                    .from('patients')
                    .upsert({
                        name: 'Test Patient',
                        email: 'patient@test.com',
                        phone_number: '+919876543210',
                        date_of_birth: '1990-01-01',
                        gender: 'M',
                        address: 'Test Address, Mumbai, India',
                        is_verified: true
                    }, {
                        onConflict: 'email'
                    })
                    .select()
                    .single();

                if (error) {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå Error:</strong> ${error.message}
                            <p style="margin-top:10px;">This might be due to RLS policies. Try running the SQL script in Supabase SQL Editor instead:</p>
                            <pre>INSERT INTO public.patients (
  name, email, phone_number, date_of_birth, gender, address, is_verified
) VALUES (
  'Test Patient', 'patient@test.com', '+919876543210',
  '1990-01-01', 'M', 'Test Address, Mumbai, India', true
) ON CONFLICT (email) DO UPDATE SET
  name = EXCLUDED.name;</pre>
                        </div>
                    `;
                    btn.disabled = false;
                    return;
                }

                resultDiv.innerHTML = `
                    <div class="success">
                        <strong>‚úÖ Patient profile created successfully!</strong>
                        <p><strong>ID:</strong> ${data.id}</p>
                        <p><strong>Name:</strong> ${data.name}</p>
                        <p><strong>Email:</strong> ${data.email}</p>
                        <p><strong>Phone:</strong> ${data.phone_number}</p>
                    </div>
                `;

                // Show next steps
                document.getElementById('step2Instructions').style.display = 'block';
                document.getElementById('step3Instructions').style.display = 'block';

            } catch (err) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Unexpected Error:</strong> ${err.message}
                    </div>
                `;
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
